-- shu_hub2.lua → NOCLIP 100% + FLY (FUNCIONA EM TUDO)
-- Repositório: https://github.com/iwzk/shu-hub
-- ATRAVESSA PAREDE, CHÃO, OBJETOS, PORTAS, TUDO

return function(library, Window, Tab1)
    getgenv().Config = { Invite = "Shu hub", Version = "0.0" }
    getgenv().luaguardvars = { DiscordName = "username#0000" }

    local Settings = library:CreateSettingsTab(Window)
    local sections = { Section1 = Tab1:AddSection("Geral", 1), Section2 = Tab1:AddSection("Exploits", 2) }

    -- === FLY + ZOMBIE IDLE (100% FUNCIONAL) ===
    getgenv().FlyActive = false
    getgenv().FlyBV = nil
    getgenv().FlyConn = nil
    getgenv().ZombieTrack = nil
    local ZOMBIE_IDLE = "rbxassetid://616158929"

    local function fly(state)
        getgenv().FlyActive = state
        local player = game.Players.LocalPlayer
        local char = player.Character or player.CharacterAdded:Wait()
        local root = char:WaitForChild("HumanoidRootPart")
        local hum = char:WaitForChild("Humanoid")

        local function playZombie()
            if getgenv().ZombieTrack then getgenv().ZombieTrack:Stop() end
            local anim = Instance.new("Animation")
            anim.AnimationId = ZOMBIE_IDLE
            getgenv().ZombieTrack = hum:LoadAnimation(anim)
            getgenv().ZombieTrack.Priority = Enum.AnimationPriority.Action4
            getgenv().ZombieTrack.Looped = true
            getgenv().ZombieTrack:Play()
        end

        local function stopAnims()
            for _, t in pairs(hum:GetPlayingAnimationTracks()) do
                if t ~= getgenv().ZombieTrack then t:Stop() end
            end
        end

        if state then
            if getgenv().FlyBV then getgenv().FlyBV:Destroy() end
            if getgenv().FlyConn then getgenv().FlyConn:Disconnect() end

            getgenv().FlyBV = Instance.new("BodyVelocity")
            getgenv().FlyBV.MaxForce = Vector3.new(1e5, 1e5, 1e5)
            getgenv().FlyBV.P = 3000
            getgenv().FlyBV.Velocity = Vector3.zero
            getgenv().FlyBV.Parent = root

            playZombie()

            getgenv().FlyConn = game:GetService("RunService").RenderStepped:Connect(function()
                if not getgenv().FlyActive then return end
                local cam = workspace.CurrentCamera
                local move = Vector3.new(
                    (game:GetService("UserInputService"):IsKeyDown(Enum.KeyCode.D) and 1 or 0) - (game:GetService("UserInputService"):IsKeyDown(Enum.KeyCode.A) and 1 or 0),
                    (game:GetService("UserInputService"):IsKeyDown(Enum.KeyCode.Space) and 1 or 0) - (game:GetService("UserInputService"):IsKeyDown(Enum.KeyCode.LeftShift) and 1 or 0),
                    (game:GetService("UserInputService"):IsKeyDown(Enum.KeyCode.S) and 1 or 0) - (game:GetService("UserInputService"):IsKeyDown(Enum.KeyCode.W) and 1 or 0)
                )
                if move.Magnitude > 0 then move = move.Unit end
                getgenv().FlyBV.Velocity = cam.CFrame:VectorToWorldSpace(move) * 60
                stopAnims()
            end)
        else
            if getgenv().FlyBV then getgenv().FlyBV:Destroy() getgenv().FlyBV = nil end
            if getgenv().FlyConn then getgenv().FlyConn:Disconnect() getgenv().FlyConn = nil end
            if getgenv().ZombieTrack then getgenv().ZombieTrack:Stop() getgenv().ZombieTrack = nil end
        end
    end

    -- === NOCLIP 100% — ATRAVESSA TUDO (MESMO COM ANTI-CHEAT) ===
    getgenv().NoClipActive = false
    getgenv().NoClipConn = nil
    getgenv().NoClipForce = nil

    local function noclip(state)
        getgenv().NoClipActive = state
        local player = game.Players.LocalPlayer
        local RunService = game:GetService("RunService")

        -- Desliga tudo
        if getgenv().NoClipConn then getgenv().NoClipConn:Disconnect() end
        if getgenv().NoClipForce then getgenv().NoClipForce = nil end

        if not state then
            local char = player.Character
            if char then
                for _, v in pairs(char:GetDescendants()) do
                    if v:IsA("BasePart") then
                        v.CanCollide = true
                        v.Massless = false
                    end
                end
                local hum = char:FindFirstChildOfClass("Humanoid")
                if hum then
                    hum.PlatformStand = false
                end
            end
            return
        end

        -- LOOP PRINCIPAL (Heartbeat)
        getgenv().NoClipConn = RunService.Heartbeat:Connect(function()
            if not getgenv().NoClipActive then return end
            local char = player.Character
            if not char or not char:FindFirstChild("HumanoidRootPart") then return end

            local hum = char:FindFirstChildOfClass("Humanoid")
            if hum then
                hum.PlatformStand = true
                pcall(function() hum:ChangeState(8) end) -- Physics
            end

            for _, part in pairs(char:GetDescendants()) do
                if part:IsA("BasePart") and part.Name ~= "HumanoidRootPart" then
                    part.CanCollide = false
                    part.Massless = true
                    part.Velocity = Vector3.new(0, 0, 0)
                    part.RotVelocity = Vector3.new(0, 0, 0)
                end
            end
        end)

        -- FORÇA A CADA 0.01s (IMBATÍVEL)
        getgenv().NoClipForce = task.spawn(function()
            while getgenv().NoClipActive do
                task.wait(0.01)
                local char = player.Character
                if char then
                    for _, part in pairs(char:GetDescendants()) do
                        if part:IsA("BasePart") and part.Name ~= "HumanoidRootPart" then
                            part.CanCollide = false
                            part.Massless = true
                        end
                    end
                end
            end
        end)
    end

    -- === PERSISTÊNCIA AO RESPAWN ===
    player.CharacterAdded:Connect(function()
        task.wait(1.5)
        if getgenv().FlyActive then fly(true) end
        if getgenv().NoClipActive then noclip(true) end
    end)

    -- === UI ===
    sections.Section1:AddToggle({ enabled = true, text = "NoClip", flag = "Atravessa tudo.", callback = noclip })
    sections.Section1:AddToggle({ enabled = true, text = "Fly", flag = "Voe como zumbi.", callback = fly })

    -- [RESTO DA UI - MANTIDO]
    sections.Section1:AddToggle({ enabled = true, text = "Fling", flag = "Fling", callback = function() end })
    sections.Section1:AddSeparator({ text = "Speed & Jump" })
    sections.Section1:AddSlider({ text = "Speed", value = 16, min = 16, max = 99, callback = function() end })
    sections.Section1:AddSlider({ text = "Jump", value = 16, min = 16, max = 99, callback = function() end })

    sections.Section1:AddSeparator({ text = "Outros" })
    sections.Section1:AddToggle({ enabled = true, text = "Anti AFK", callback = function() end })
    sections.Section1:AddToggle({ enabled = true, text = "Free Cam", callback = function() end })
    sections.Section1:AddToggle({ enabled = true, text = "Building Tools", callback = function() end })
    sections.Section1:AddToggle({ enabled = true, text = "Ghost mode", callback = function() end })

    -- Exploits (só visual)
    sections.Section2:AddToggle({ enabled = true, text = "Auto Pesca", callback = function() end })
    sections.Section2:AddSlider({ text = "Vel. Pesca", value = 10, min = 10, max = 50, callback = function() end })
    sections.Section2:AddToggle({ enabled = true, text = "Vender Peixes", callback = function() end })
    sections.Section2:AddSlider({ text = "Tempo Vendas", value = 5, min = 5, max = 30, callback = function() end })

    sections.Section2:AddSeparator({ text = "Chat" })
    sections.Section2:AddToggle({ enabled = true, text = "Privado Explanado", callback = function() end })
    sections.Section2:AddToggle({ enabled = true, text = "Esconder Chat", callback = function() end })

    sections.Section2:AddSeparator({ text = "Visual" })
    sections.Section2:AddToggle({ enabled = true, text = "ESP", callback = function() end })
    sections.Section2:AddSlider({ text = "Render ESP", value = 50, min = 50, max = 100, callback = function() end })
    sections.Section2:AddToggle({ enabled = true, text = "Espectar", callback = function() end })
    sections.Section2:AddList({ enabled = true, text = "Jogador", value = "Selecione", values = {"shu", "drugs", "licy"}, callback = function() end })
    sections.Section2:AddToggle({ enabled = true, text = "Xray", callback = function() end })
    sections.Section2:AddToggle({ enabled = true, text = "Korblox & Headless", callback = function() end })

    sections.Section2:AddSeparator({ text = "Combate" })
    sections.Section2:AddToggle({ enabled = true, text = "Aimbot", callback = function() end })
    sections.Section2:AddToggle({ enabled = true, text = "Mostrar FOV", callback = function() end })
    sections.Section2:AddSlider({ text = "Tamanho FOV", value = 50, min = 1, max = 100, callback = function() end })

    Window:SetOpen(true)
    print("SHU HUB 2: NOCLIP 100% + FLY ATIVOS")
end
