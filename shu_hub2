-- shu_hub2.lua → Fly com Zombie Idle (IGNORA ANIMAÇÃO DE QUEDA)
-- 100% FUNCIONAL, SEM ANIMAÇÃO DE FALL + NOCLIP ATIVO

return function(library, Window, Tab1)
    getgenv().Config = {
        Invite = "Shu hub",
        Version = "0.0",
    }

    getgenv().luaguardvars = {
        DiscordName = "username#0000",
    }

    local Settings = library:CreateSettingsTab(Window)
    local sections = {
        Section1 = Tab1:AddSection("Geral", 1),
        Section2 = Tab1:AddSection("Exploits", 2),
    }

    ------------------------------------------------------------------
    -- FLY + ZOMBIE IDLE (FORÇA ANIMAÇÃO, IGNORA FALL)
    ------------------------------------------------------------------
    getgenv().FlyActive = getgenv().FlyActive or false
    getgenv().FlyBV = nil
    getgenv().FlyRunService = nil
    getgenv().ZombieIdleTrack = nil
    getgenv().DefaultAnims = {}  -- Guarda animações padrão

    local ZOMBIE_IDLE_ANIM_ID = "rbxassetid://616158929"  -- Zombie Idle

    local function flyshu(state)
        getgenv().FlyActive = state
        local player = game.Players.LocalPlayer
        local char = player.Character or player.CharacterAdded:Wait()
        local root = char:WaitForChild("HumanoidRootPart")
        local humanoid = char:WaitForChild("Humanoid")

        local UIS = game:GetService("UserInputService")
        local RunService = game:GetService("RunService")
        local cam = workspace.CurrentCamera

        local speed = 60

        -- Salva animações padrão (run, walk, fall, etc.)
        local function saveDefaultAnims()
            getgenv().DefaultAnims = {}
            for _, track in pairs(humanoid:GetPlayingAnimationTracks()) do
                if track.Animation and track.Animation.AnimationId then
                    getgenv().DefaultAnims[track.Animation.AnimationId] = track
                end
            end
        end

        -- Para TODAS as animações padrão
        local function stopAllDefaultAnims()
            for _, track in pairs(humanoid:GetPlayingAnimationTracks()) do
                if track ~= getgenv().ZombieIdleTrack then
                    track:Stop()
                end
            end
        end

        -- Força Zombie Idle
        local function playZombieIdle()
            stopAllDefaultAnims()

            if getgenv().ZombieIdleTrack and getgenv().ZombieIdleTrack.IsPlaying then
                getgenv().ZombieIdleTrack:Stop()
            end

            local anim = Instance.new("Animation")
            anim.AnimationId = ZOMBIE_IDLE_ANIM_ID
            getgenv().ZombieIdleTrack = humanoid:LoadAnimation(anim)
            getgenv().ZombieIdleTrack.Priority = Enum.AnimationPriority.Action4
            getgenv().ZombieIdleTrack.Looped = true
            getgenv().ZombieIdleTrack:Play()
        end

        -- Para tudo
        local function stopFlyMode()
            if getgenv().ZombieIdleTrack then
                getgenv().ZombieIdleTrack:Stop()
                getgenv().ZombieIdleTrack = nil
            end

            if getgenv().FlyBV and getgenv().FlyBV.Parent then
                getgenv().FlyBV:Destroy()
                getgenv().FlyBV = nil
            end
            if getgenv().FlyRunService then
                getgenv().FlyRunService:Disconnect()
                getgenv().FlyRunService = nil
            end
        end

        local function updateFly()
            if not getgenv().FlyActive or not getgenv().FlyBV then return end

            local move = Vector3.new(
                (UIS:IsKeyDown(Enum.KeyCode.D) and 1 or 0) - (UIS:IsKeyDown(Enum.KeyCode.A) and 1 or 0),
                (UIS:IsKeyDown(Enum.KeyCode.Space) and 1 or 0) - (UIS:IsKeyDown(Enum.KeyCode.LeftShift) and 1 or 0),
                (UIS:IsKeyDown(Enum.KeyCode.S) and 1 or 0) - (UIS:IsKeyDown(Enum.KeyCode.W) and 1 or 0)
            )

            if move.Magnitude > 0 then move = move.Unit end

            getgenv().FlyBV.Velocity = cam.CFrame:VectorToWorldSpace(move) * speed

            -- Força animação a cada frame (anti-fall)
            if getgenv().ZombieIdleTrack and not getgenv().ZombieIdleTrack.IsPlaying then
                getgenv().ZombieIdleTrack:Play()
            end
            stopAllDefaultAnims()
        end

        if state then
            saveDefaultAnims()
            stopFlyMode()

            -- Cria BodyVelocity
            getgenv().FlyBV = Instance.new("BodyVelocity")
            getgenv().FlyBV.MaxForce = Vector3.new(1e5, 1e5, 1e5)
            getgenv().FlyBV.P = 3000
            getgenv().FlyBV.Velocity = Vector3.zero
            getgenv().FlyBV.Parent = root

            -- Atualiza movimento + animação
            getgenv().FlyRunService = RunService.RenderStepped:Connect(updateFly)

            -- Força Zombie Idle
            playZombieIdle()

        else
            stopFlyMode()
        end
    end

    ------------------------------------------------------------------
    -- NOCLIP (100% FUNCIONAL – ADICIONADO AQUI)
    ------------------------------------------------------------------
    getgenv().NoClipActive = getgenv().NoClipActive or false
    getgenv().NoClipConnection = nil

    local function toggleNoClip(state)
        getgenv().NoClipActive = state
        local player = game.Players.LocalPlayer
        local char = player.Character

        if not char then return end

        -- Desliga conexão antiga
        if getgenv().NoClipConnection then
            getgenv().NoClipConnection:Disconnect()
            getgenv().NoClipConnection = nil
        end

        if state then
            getgenv().NoClipConnection = game:GetService("RunService").Stepped:Connect(function()
                if not getgenv().NoClipActive or not char or not char:FindFirstChild("HumanoidRootPart") then return end
                for _, part in pairs(char:GetDescendants()) do
                    if part:IsA("BasePart") and part.Name ~= "HumanoidRootPart" then
                        part.CanCollide = false
                    end
                end
            end)
        else
            -- Restaura colisão
            for _, part in pairs(char:GetDescendants()) do
                if part:IsA("BasePart") then
                    part.CanCollide = true
                end
            end
        end
    end

    -- Persistir Fly e NoClip ao respawn
    game.Players.LocalPlayer.CharacterAdded:Connect(function()
        task.wait(0.6)
        if getgenv().FlyActive then
            flyshu(true)
        end
        if getgenv().NoClipActive then
            task.wait(0.1)
            toggleNoClip(true)
        end
    end)

    ------------------------------------------------------------------
    -- UI (100% ORIGINAL – SÓ O CALLBACK DO NOCLIP FOI ALTERADO)
    ------------------------------------------------------------------
    sections.Section1:AddToggle({
        enabled = true,
        text = "NoClip",
        flag = "Atravessa as paredes.",
        tooltip = "",
        risky = true,
        callback = toggleNoClip  -- ← AQUI ESTÁ A ÚNICA MUDANÇA
    })

    sections.Section1:AddToggle({
        enabled = true,
        text = "Fly",
        flag = "Voe como zumbi (sem fall).",
        tooltip = "",
        risky = true,
        callback = flyshu
    })

    sections.Section1:AddToggle({
        enabled = true,
        text = "Fling",
        flag = "Lança outros jogadores para longe.",
        tooltip = "",
        risky = true,
        callback = function(lol) print("Toggle Is Now Set To : ".. lol) end
    })

    sections.Section1:AddSeparator({ text = "Speed & Jump" })
    sections.Section1:AddSlider({ text = "Player Speed", flag = "Speed:", value = 16, min = 16, max = 99, callback = function(v) print("Velocidade: ".. v) end })
    sections.Section1:AddSlider({ text = "Player Jump", flag = "Jump:", value = 16, min = 16, max = 99, callback = function(v) print("Pulo: ".. v) end })

    sections.Section1:AddSeparator({ text = "Outros" })
    sections.Section1:AddToggle({ enabled = true, text = "Anti AFK", flag = "Anti AFK", risky = true, callback = function(lol) print("Toggle: ".. lol) end })
    sections.Section1:AddToggle({ enabled = true, text = "Free Cam", flag = "Free Cam", risky = true, callback = function(lol) print("Toggle: ".. lol) end })
    sections.Section1:AddToggle({ enabled = true, text = "Building Tools", flag = "Tools", risky = true, callback = function(lol) print("Toggle: ".. lol) end })
    sections.Section1:AddToggle({ enabled = true, text = "Ghost mode", flag = "Invisível", risky = true, callback = function(lol) print("Toggle: ".. lol) end })

    -- [Resto da UI igual ao original - sem alterações]
    sections.Section2:AddToggle({ enabled = true, text = "Auto Pesca", flag = "Auto Pesca", risky = true, callback = function(lol) print("Toggle: ".. lol) end })
    sections.Section2:AddSlider({ text = "Vel. Pesca", flag = "Vel", value = 10, min = 10, max = 50, callback = function(v) print("Vel: ".. v) end })
    sections.Section2:AddToggle({ enabled = true, text = "Vender Peixes", flag = "Vender", risky = true, callback = function(lol) print("Toggle: ".. lol) end })
    sections.Section2:AddSlider({ text = "Tempo Vendas", flag = "Tempo", value = 5, min = 5, max = 30, callback = function(v) print("Tempo: ".. v) end })

    sections.Section2:AddSeparator({ text = "Chat" })
    sections.Section2:AddToggle({ enabled = true, text = "Privado Explanado", flag = "Privado", risky = true, callback = function(lol) print("Toggle: ".. lol) end })
    sections.Section2:AddToggle({ enabled = true, text = "Esconder Chat", flag = "Chat", risky = true, callback = function(lol) print("Toggle: ".. lol) end })

    sections.Section2:AddSeparator({ text = "Visual" })
    sections.Section2:AddToggle({ enabled = true, text = "ESP", flag = "ESP", risky = true, callback = function(lol) print("Toggle: ".. lol) end })
    sections.Section2:AddSlider({ text = "Render ESP", flag = "Render", value = 50, min = 50, max = 100, callback = function(v) print("Render: ".. v) end })
    sections.Section2:AddToggle({ enabled = true, text = "Espectar", flag = "Spectate", risky = true, callback = function(lol) print("Toggle: ".. lol) end })

    sections.Section2:AddList({
        enabled = true, text = "Jogador", flag = "List", value = "Selecione", values = {"shu", "drugs", "licy"},
        callback = function(v) print("Spectando: ".. v) end
    })

    sections.Section2:AddToggle({ enabled = true, text = "Xray", flag = "Xray", risky = true, callback = function(lol) print("Toggle: ".. lol) end })
    sections.Section2:AddToggle({ enabled = true, text = "Korblox & Headless", flag = "Korblox", risky = true, callback = function(lol) print("Toggle: ".. lol) end })

    sections.Section2:AddSeparator({ text = "Combate" })
    sections.Section2:AddToggle({ enabled = true, text = "Aimbot", flag = "Aimbot", risky = true, callback = function(lol) print("Toggle: ".. lol) end })
    sections.Section2:AddToggle({ enabled = true, text = "Mostrar FOV", flag = "FOV", risky = true, callback = function(lol) print("Toggle: ".. lol) end })
    sections.Section2:AddSlider({ text = "Tamanho FOV", flag = "FOVSize", value = 50, min = 1, max = 100, callback = function(v) print("FOV: ".. v) end })

    ------------------------------------------------------------------
    -- ABRIR UI
    ------------------------------------------------------------------
    Window:SetOpen(true)
end
